Bootstrap: docker
From: scilus/scilus:1.5.0

%labels
    version ChildBrainFlow-1.0.0

%post
    # Installing FreeSurfer on top of scilus:1.5.0
    cd /root
    wget https://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/7.2.0/freesurfer-linux-centos7_x86_64-7.2.0.tar.gz -O fs.tar.gz
    tar --no-same-owner -xzvf fs.tar.gz
    mv freesurfer /usr/local
    rm fs.tar.gz

    # Install required tcsh and csh.
    apt-get update
    apt-get install -y csh tcsh

    # Setup FreeSurfer environment
    export OS=Linux
    export PATH=/usr/local/freesurfer/bin:/usr/local/freesurfer/fsfast/bin:/usr/local/freesurfer/tktools:/usr/local/freesurfer/mni/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    export FREESURFER_HOME=/usr/local/freesurfer
    export FREESURFER=/usr/local/freesurfer
    export SUBJECTS_DIR=/usr/local/freesurfer/subjects
    export LOCAL_DIR=/usr/local/freesurfer/local
    export FSFAST_HOME=/usr/local/freesurfer/fsfast
    export FMRI_ANALYSIS_DIR=/usr/local/freesurfer/fsfast
    export FUNCTIONALS_DIR=/usr/local/freesurfer/sessions

    # Set default FreeSurfer options
    export FS_OVERRIDE=0
    export FIX_VERTEX_AREA=""
    export FSF_OUTPUT_FORMAT=nii.gz

    # Set MNI environment requirements
    export MINC_BIN_DIR=/usr/local/freesurfer/mni/bin
    export MINC_LIB_DIR=/usr/local/freesurfer/mni/lib
    export MNI_DIR=/usr/local/freesurfer/mni
    export MNI_DATAPATH=/usr/local/freesurfer/mni/data
    export MNI_PERL5LIB=/usr/local/freesurfer/mni/share/perl5
    export PERL5LIB=/usr/local/freesurfer/mni/share/perl5


    # Download additional files
    wget -O /freesurfer/license.txt https://www.dropbox.com/scl/fi/0s8lp6lydyd0rxawxb4jm/license.txt?rlkey=hz54oc0d4sor69avqphtrjvgn&dl=0
    wget -O /root/FS_BN_GL_SF_utils.tar https://www.dropbox.com/s/zzptxby9pf5lpih/FS_BN_GL_SF_utils.tar?dl=0?download=1
    tar -xzvf FS_BN_GL_SF_utils.tar
    rm FS_BN_GL_SF_utils.tar

%environment
    export OS=Linux
    export PATH=/usr/local/freesurfer/bin:/usr/local/freesurfer/fsfast/bin:/usr/local/freesurfer/tktools:/usr/local/freesurfer/mni/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    export FREESURFER_HOME=/usr/local/freesurfer
    export FREESURFER=/usr/local/freesurfer
    export SUBJECTS_DIR=/usr/local/freesurfer/subjects
    export LOCAL_DIR=/usr/local/freesurfer/local
    export FSFAST_HOME=/usr/local/freesurfer/fsfast
    export FMRI_ANALYSIS_DIR=/usr/local/freesurfer/fsfast
    export FUNCTIONALS_DIR=/usr/local/freesurfer/sessions
    export FS_OVERRIDE=0
    export FIX_VERTEX_AREA=""
    export FSF_OUTPUT_FORMAT=nii.gz
    export MINC_BIN_DIR=/usr/local/freesurfer/mni/bin
    export MINC_LIB_DIR=/usr/local/freesurfer/mni/lib
    export MNI_DIR=/usr/local/freesurfer/mni
    export MNI_DATAPATH=/usr/local/freesurfer/mni/data
    export MNI_PERL5LIB=/usr/local/freesurfer/mni/share/perl5
    export PERL5LIB=/usr/local/freesurfer/mni/share/perl5
