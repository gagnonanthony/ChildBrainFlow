
DWI Pipeline
========================

Pipeline adapted from the SCIL Tractoflow pipeline (https://github.com/scilus/tractoflow.git) [1].

The connectomics processes are imported from the Connectoflow pipeline (https://github.com/scilus/connectoflow.git). 

[1] Theaud, G., Houde, J.-C., Boré, A., Rheault, F., Morency, F., Descoteaux, M.,
    TractoFlow: A robust, efficient and reproducible diffusion MRI pipeline
    leveraging Nextflow & Singularity, NeuroImage,
    https://doi.org/10.1016/j.neuroimage.2020.116889.


Run Connectomics Pipeline Infant Config

nextflow run main.nf [OPTIONAL_ARGUMENTS] --input [input_folder] -profile connectomics,infant

DESCRIPTION

    --input=/path/to/[input_folder]             Input folder containing multiple subjects

                                                [Input]
                                                ├-- S1
                                                |   ├-- *dwi.nii.gz
                                                |   ├-- *.bval
                                                |   ├-- *.bvec
                                                |   |-- *t2w_warped.nii.gz
                                                |   ├-- *.trk
                                                |   ├-- *labels.nii.gz
                                                |   ├-- *peaks.nii.gz
                                                |   ├-- *fodf.nii.gz
                                                |   ├-- OGenericAffine.mat
                                                |   ├-- output1Warp.nii.gz
                                                |   └-- metrics
                                                |       └-- METRIC_NAME.nii.gz  [Optional]
                                                └-- S2
                                                    ├-- *dwi.nii.gz
                                                    ├-- *bval
                                                    ├-- *bvec
                                                    |-- *t2w_warped.nii.gz
                                                    ├-- *.trk
                                                    ├-- *labels.nii.gz
                                                    ├-- *peaks.nii.gz
                                                    ├-- *fodf.nii.gz
                                                    ├-- OGenericAffine.mat
                                                    ├-- output1Warp.nii.gz
                                                    └-- metrics
                                                        └-- METRIC_NAME.nii.gz  [Optional]

[CONNECTOMICS OPTIONS]

    DECOMPOSE OPTIONS
    --no_pruning                                If set, will not prune on length ($no_pruning)
    --no_remove_loops                           If set, will not remove streamlines making loops ($no_remove_loops)
    --no_remove_outliers                        If set, will not remove outliers using QB ($no_remove_outliers)
    --min_length                                Pruning minimal segment length ($min_length)
    --max_length                                Pruning maximal segment length ($max_length)
    --loop_max_angle                            Maximal winding angle over which a streamline is considered as looping 
                                                ($loop_max_angle)
    --outlier_threshold                         Outlier removal threshold when using hierarchical QB 
                                                ($outlier_threshold)

    COMMIT OPTIONS
    --run_commit                                If set, COMMIT will be run on the tractogram. ($run_commit)
    --use_commit2                               If set, COMMIT2 will be use rather than COMMIT1. ($use_commit2)
                                                COMMIT2 output will replaced the COMMIT1 output.
    --b_thr                                     Tolerance value to considier bvalues to be the same shell.
    --nbr_dir                                   Number of directions, (half sphere), representing the possible 
                                                orientations of the response functions ($nbr_dir)
    --ball_stick                                If set, will use the ball&stick model and disable the zeppelin 
                                                compartment for single-shell data. ($ball_stick)
    --para_diff                                 Parallel diffusivity in mm^2/s ($para_diff)
    --iso_diff                                  Isotropic diffusivity in mm^2/s ($iso_diff)

    PROCESSES OPTIONS
    --processes_commit                          Number of processes for COMMIT task ($processes_commit)
    --processes_afd_fixel                       Number of processes for AFD_FIXEL task ($processes_afd_fixel)
    --processes_connectivity                    Number of processes for connectivity task ($processes_connectivity)

[GLOBAL OPTIONS]

    OUTPUT OPTIONS
    --output_dir                                Directory to write the final results. Default is 
                                                "./Results_Infant_Tracking/".

AVAILABLE PROFILES (using -profile option (e.g. -profile no_symlink,macos,tracking))

no_symlink                                      When used, results will be directly copied in the output folder and 
                                                symlink will not be used.

macos                                           When used, the scratch folder will be modified for MacOS users.

tracking                                        When used, will perform the tracking pipeline to generate the 
                                                whole-brain tractogram from raw diffusion images.

connectomics                                    When used, will perform connectivity analysis between atlas-based 
                                                segmentation.

NOTES

The 'scilpy/scripts' folder should be in your PATH environment variable. Not necessary if the
Singularity container is used.

The intermediate working directory is, by default, set to './work'.
To change it, use the '-w WORK_DIR' argument.

The default config file is tractoflow/nextflow.config.
Use '-C config_file.config' to specify a non-default configuration file.
The '-C config_file.config' must be inserted after the nextflow call
like 'nextflow -C config_file.config run ...'.